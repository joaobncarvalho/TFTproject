
<html>

<head>
  
    
  <title>Express 2</title>
  <link rel="stylesheet" href="stylesheets/mainpage.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <script src="https://kit.fontawesome.com/15e6590408.js" crossorigin="anonymous"></script>

  <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>

  <a href="secondpagetest.html">

    <img src="./images/tftlogo-removebg-preview.png" style="width: 8%; height: 19%; position:absolute; margin-top: -3.4%;">

  </a>
  <div class="topnav" id="myTopnav" style="width: 1550px; margin-left: -4%; margin-top: -0.6%;">
    <div class="items" style="margin-left: 76%;">
     
    <a href="secondpagetest.html" class="active" style="">Home</a>
    <a href="#news" style="">Avaliar</a>
    <a href="#contact" style="">Contacto</a>
    <a href="#about" style="">Sobre Nós</a>
    <a href="javascript:void(0);" class="icon" onclick="myFunction()">
      <i class="fa fa-bars"></i>
    </a>
    </div>
  </div>

</head>

<body>

  <!-- FILTER DROPDOWN'S -->

  <div class="dropdown" style="position:absolute; margin-left: 52%; margin-top: 4.7%;">
    <button onclick="myFunction()" class="dropbtn">Género</button>
    <div id="myDropdown" class="dropdown-content">
      <input type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()">
      <a href="#about" onclick="filterbygenre(1)" id="1">Ação

        <i class="fa-solid fa-gun"></i>

      </a>
      <a href="#base" onclick="filterbygenre(2)" id="2">Indie

        <i class="fa-solid fa-face-smile"></i>

      </a>
      <a href="#blog" onclick="filterbygenre(3)" id="3">Aventura

        <i class="fa-solid fa-map"></i>

      </a>
      <a href="#contact" onclick="filterbygenre(4)" id="4">RPG

        <i class="fa-solid fa-gem"></i>

      </a>
      <a href="#custom" onclick="filterbygenre(5)" id="5">Estratégia

        <i class="fa-solid fa-chess"></i>

      </a>
      <a href="#support" onclick="filterbygenre(6)" id="6">Tiro

        <i class="fa-solid fa-bullseye"></i>

      </a>
      <a href="#tools" onclick="filterbygenre(7)" id="7">Casual

        <i class="fa-solid fa-gamepad"></i>

      </a>

      <a href="#tools" onclick="filterbygenre(8)" id="8">Simulador

        <i class="fa-solid fa-vr-cardboard"></i>

      </a>

      <a href="#tools" onclick="filterbygenre(9)" id="9">Puzzle

        <i class="fa-solid fa-puzzle-piece"></i>

      </a>

      <a href="#tools" onclick="filterbygenre(10)" id="10">Arcade

        <i class="fa-solid fa-ghost"></i>

      </a>

      <a href="#tools" onclick="filterbygenre(11)" id="11">Plataforma

        <i class="fa-solid fa-compass"></i>

      </a>

      <a href="#tools" onclick="filterbygenre(12)" id="12">Corrida

        <i class="fa-solid fa-car"></i>

      </a>

      <a href="#tools" onclick="filterbygenre(13)" id="13">MMO

        <i class="fa-solid fa-khanda"></i>

      </a>

      <a href="#tools" onclick="filterbygenre(14)" id="14">Desporto

        <i class="fa-solid fa-futbol"></i>

      </a>

      <a href="#tools" onclick="filterbygenre(15)" id="15">Luta

        <i class="fa-solid fa-user-ninja"></i>

      </a>

      <a href="#tools" onclick="filterbygenre(16)" id="16">Familiar

        <i class="fa-solid fa-people-roof"></i>

      </a>

      <a href="#tools" onclick="filterbygenre(17)" id="17">Tabuleiro

        <i class="fa-solid fa-chess-board"></i>

      </a>

      <a href="#tools" onclick="filterbygenre(18)" id="18">Educacional

        <i class="fa-solid fa-chalkboard-user"></i>

      </a>

      <a href="#tools" onclick="filterbygenre(19)" id="19">Cartas

        <i class="fa-solid fa-diamond"></i>

      </a>
    </div>
  </div>

  <!--FILTRO POR PLATAFORMAS-->

  <div class="dropdown" style="position:absolute; margin-left: 60%; margin-top: 4.7%;">
    <button onclick="myFunction2()" class="dropbtn2">Plataforma</button>
    <div id="myDropdown2" class="dropdown-content">
      <input type="text" placeholder="Search.." id="myInput2" onkeyup="filterFunction2()">
      <a href="#about" onclick="filterbyplatform(1)">PC

        <i class="fa-solid fa-laptop"></i>

      </a>
      <a href="#base" onclick="filterbyplatform(2)">PlayStation 5

        <i class="fa-brands fa-playstation"></i>

      </a>
      <a href="#blog" onclick="filterbyplatform(3)">PlayStation 4

        <i class="fa-brands fa-playstation"></i>

      </a>
      <a href="#contact" onclick="filterbyplatform(4)">XBox One

        <i class="fa-brands fa-xbox"></i>

      </a>
      <a href="#custom" onclick="filterbyplatform(5)">XBox Series S/X

        <i class="fa-brands fa-xbox"></i>

      </a>
      <a href="#support" onclick="filterbyplatform(6)">Nintendo Switch

        <i class="fa-solid fa-n"></i>

      </a>
      <a href="#tools" onclick="filterbyplatform(7)">iOS

        <i class="fa-brands fa-app-store-ios"></i>

      </a>

      <a href="#tools" onclick="filterbyplatform(8)">Android

        <i class="fa-brands fa-android"></i>

      </a>

      <a href="#tools" onclick="filterbyplatform(9)">Nintendo 3DS

        <i class="fa-solid fa-n"></i>

      </a>

      <a href="#tools" onclick="filterbyplatform(10)">Nintendo DS

        <i class="fa-solid fa-n"></i>

      </a>

      <a href="#tools" onclick="filterbyplatform(11)">macOS

        <i class="fa-brands fa-apple"></i>

      </a>

      <a href="#tools" onclick="filterbyplatform(12)">Linux

        <i class="fa-brands fa-linux"></i>

      </a>

      <a href="#tools" onclick="filterbyplatform(13)">XBox 360

        <i class="fa-brands fa-xbox"></i>

      </a>

      <a href="#tools" onclick="filterbyplatform(14)">XBox

        <i class="fa-brands fa-xbox"></i>

      </a>

      <a href="#tools" onclick="filterbyplatform(15)">PlayStation 3

        <i class="fa-brands fa-playstation"></i>

      </a>

      <a href="#tools" onclick="filterbyplatform(16)">Wii U

        <i class="fa-solid fa-w"></i>

      </a>

      <a href="#tools" onclick="filterbyplatform(17)">Wii

        <i class="fa-solid fa-w"></i>

      </a>

      <a href="#tools" onclick="filterbyplatform(18)">Browser

        <i class="fa-brands fa-edge"></i>

      </a>

      <a href="#tools" onclick="filterbyplatform(19)">Web

        <i class="fa-solid fa-desktop"></i>

      </a>
    </div>
  </div>

  <div class="dropdown" style="position:absolute; margin-left: 70%; margin-top: 4.7%;">
    <button onclick="myFunction3()" class="dropbtn3">Lançamento</button>
    <div id="myDropdown3" class="dropdown-content">
      <input type="text" placeholder="Search.." id="myInput3" onkeyup="filterFunction3()">
      <a href="#about" onclick="filterbydaterecent()">Mais Recentes

        <i class="fa-solid fa-plus"></i>

      </a>

      <a href="#about" onclick="filterbydateolder()">Mais Antigos

        <i class="fa-solid fa-minus"></i>

      </a>
      
    </div>
  </div>

  <div class="dropdown" style="position:absolute; margin-left: 80%; margin-top: 4.7%;">
    <button onclick="myFunction4()" class="dropbtn4">Avaliação</button>
    <div id="myDropdown4" class="dropdown-content">
      <input type="text" placeholder="Search.." id="myInput4" onkeyup="filterFunction4()">
      <a href="#about" onclick="filterbyratingbest()">Melhor Avaliação

        <i class="fa-solid fa-plus"></i>

      </a>

      <a href="#about" onclick="filterbyratingworst()">Pior Avaliação

        <i class="fa-solid fa-minus"></i>

      </a>
      
    </div>
  </div>

  <div style="background-color: rgb(54, 54, 54); width: 96.6%; height: 230%; margin-left: 3%;">


    <div id="jogosrecentes">

     <h2 style="position: absolute; margin-top: 5%; margin-left: 3%; font-size: 30px;">Descobrir Jogos</h2>

     <div style="background-color:aliceblue; width:90%; height:0.1%; position:absolute; margin-top: 8.4%; margin-left: 3%;">

    </div>

   
   
  </div>

<nav class="main-menu">

  
  <div>
     <a class="logo" href="http://startific.com">
     </a> 
   </div> 
 <div class="settings"></div>
 <div class="scrollbar" id="style-1">
       
 <ul>
   
 <li>                                   
 <a href="secondpagetest.html">
 <i class="fa fa-home fa-lg"></i>
 <span class="nav-text">Home</span>
 </a>
 </li>   
    
 <li>                                 
 <a href="descobrirjogos.html">
 <i class="fa fa-user fa-lg"></i>
 <span class="nav-text">Descobrir Jogos</span>
 </a>
 </li>   
 
     
 <li>                                 
 <a href="livraria.html">
 <i class="fa fa-envelope-o fa-lg"></i>
 <span class="nav-text">Livraria</span>
 </a>
 </li>   
   
 
 
  
 <li>
 <a href="wishlist.html">
 <i class="fa fa-heart-o fa-lg"></i>
                         
 <span class="nav-text">Wishlist</span>
 
 
 <li>
  <a href="favoritos.html">
  <i class="fa fa-clock-o fa-lg"></i>
  <span class="nav-text">Favoritos</span>
  </a>
  </li>
 
  <li>
    <a href="plataformas.html">
    <i class="fa fa-desktop fa-lg"></i>
    <span class="nav-text">Plataformas</span>
    </a>
    </li>
  
    <li>
      <a href="aminhaconta.html">
      <i class="fa fa-plane fa-lg"></i>
      <span class="nav-text">A Minha Conta</span>
      </a>
      </li>

      <li>
        <a href="register.html">
        <i class="fa fa-shopping-cart"></i>
         <span class="nav-text">Logout</span>
        </a>
        </li>
   
 </div>
 
         </nav>

         <div id="organize"> <!-- DIV PARA REPRESENTAR OS JOGOS (EXIBIR OS JOGOS) -->

            

         </div>

         <script>

          //GET THE LOGGED USER

          window.onload = function exampleFunction() {
            console.log('The Script will load now.');

            var utilizador_name = sessionStorage.getItem("utilizador_name");
            let utilizador_dinheiro = sessionStorage.getItem("utilizador_dinheiro");
            var utilizador_email = sessionStorage.getItem("utilizador_email");
            var utilizador_id = sessionStorage.getItem("utilizador_id");

            console.log(utilizador_name);

            //GET DOS JOGOS

            getGames();

            

         }

         async function filterbyratingworst(){

let gamesElem = document.getElementById("organize");

try{

let games = await $.ajax({

url: "/games/games/rating/worst",
method: "get",
dataType: "json",

});

console.log("[utilizador] utilizador = " + JSON.stringify(games));

let html = "";

for(let game of games){
console.log("Jogo: " + game);
html += creategameHTML(game);
}

console.log("OBTEVE");
//  recipeName.innerHTML = html;

gamesElem.innerHTML = html;


} catch(err){
console.log(err);
}


}

         async function filterbyratingbest(){

          let gamesElem = document.getElementById("organize");

          try{

let games = await $.ajax({

url: "/games/games/rating/best",
method: "get",
dataType: "json",

});

console.log("[utilizador] utilizador = " + JSON.stringify(games));

let html = "";

for(let game of games){
console.log("Jogo: " + game);
html += creategameHTML(game);
}

console.log("OBTEVE");
//  recipeName.innerHTML = html;

gamesElem.innerHTML = html;


} catch(err){
console.log(err);
}


         }

         async function filterbydateolder(){

let gamesElem = document.getElementById("organize");

try{

let games = await $.ajax({

url: "/games/games/lancamento/antigos/",
method: "get",
dataType: "json",

});

console.log("[utilizador] utilizador = " + JSON.stringify(games));

let html = "";

for(let game of games){
console.log("Jogo: " + game);
html += creategameHTML(game);
}

console.log("OBTEVE");
//  recipeName.innerHTML = html;

gamesElem.innerHTML = html;


} catch(err){
console.log(err);
}

}

         //FUNCAO DE FILTRO POR DATA 

         async function filterbydaterecent(){

          let gamesElem = document.getElementById("organize");

          try{

let games = await $.ajax({

  url: "/games/games/lancamento/recentes/",
  method: "get",
  dataType: "json",

});

console.log("[utilizador] utilizador = " + JSON.stringify(games));

let html = "";

for(let game of games){
console.log("Jogo: " + game);
html += creategameHTML(game);
}

console.log("OBTEVE");
//  recipeName.innerHTML = html;

gamesElem.innerHTML = html;


} catch(err){
console.log(err);
}

         }

         //FUNCAO DE FILTRO POR PLATAFORMA

         async function filterbyplatform(platform_id){

          let gamesElem = document.getElementById("organize");

          console.log("ID da plataforma selecionada: "  + platform_id);

          try{

let games = await $.ajax({

  url: "/games/games/plataforma/" + platform_id,
  method: "get",
  dataType: "json",

});

console.log("[utilizador] utilizador = " + JSON.stringify(games));

let html = "";

for(let game of games){
console.log("Jogo: " + game);
html += creategameHTML(game);
}

console.log("OBTEVE");
//  recipeName.innerHTML = html;

gamesElem.innerHTML = html;


} catch(err){
console.log(err);
}
 
         }

         //FUNCAO DE FILTRO POR GENERO

async function filterbygenre(genre_id){

  let gamesElem = document.getElementById("organize");

console.log("ID do genero: " + genre_id);

try{

  let games = await $.ajax({

    url: "/games/games/genero/" + genre_id,
    method: "get",
    dataType: "json",

  });

  console.log("[utilizador] utilizador = " + JSON.stringify(games));

  let html = "";

for(let game of games){
 console.log("Jogo: " + game);
 html += creategameHTML(game);
}

console.log("OBTEVE");
//  recipeName.innerHTML = html;

gamesElem.innerHTML = html;


} catch(err){
 console.log(err);
}

}

         async function getGames(){

console.log("Obtendo os jogos")

// let recipeName = document.getElementById("nome1")
 let gamesElem = document.getElementById("organize");
 var utilizador_id = sessionStorage.getItem("utilizador_id");
 console.log("setItem->userId = " + utilizador_id);

try{

let games = await $.ajax({

url: "/games/allgames/",
method: "get",
dataType: "json",

});

console.log("[utilizador] utilizador = " + JSON.stringify(games));

let html = "";

for(let game of games){
 console.log("Jogo: " + game);
 html += creategameHTML(game);
}

console.log("OBTEVE");
//  recipeName.innerHTML = html;

gamesElem.innerHTML = html;


} catch(err){
 console.log(err);
}
}

function creategameHTML(jogo){
  
  return "<div class='selectbox55' id='selectbox55'>" + "<p name='gamename1' id='gamename1' style='text-align: center; font-size: 90%; margin-top: 10%;color:black;'><b>" + jogo.jogo_name + "</b></p>" + "<p name='gamereleased1' id='gamereleased1' style='text-align: center; font-size: 90%; margin-top: 22%;color:black;'>" + jogo.jogo_released + "</p>" + "<p name='rating1' id='rating1' style='text-align: center; font-size: 90%; margin-top: 1%;color:black;'>" + jogo.jogo_rating + "</p>" + "<p name='downloads1' id='downloads1' style='text-align: center; font-size: 90%; margin-top: 1%;color:black;'>" + jogo.jogo_downloads + "</p>" + "<p name='downloads1' id='downloads1' style='text-align: center; font-size: 90%; margin-top: 1%;color:black;'>" + jogo.jogo_preco + "</p>" +  "<button onclick='addtolibrary("+ JSON.stringify(jogo) + ")' style='margin-top: 5%; margin-left: 7%;'>Comprar Jogo</button>" + "<button onclick='addtowishlist(" + JSON.stringify(jogo) + ")'>Adicionar á Wishlist</button>" + "</div>"
 
  // return "<div class='selectbox5' id='selectbox55'>" + recipe.receita_titulo + "</div>";

 /*<p name="criador1" id="criador1" style="text-align: center;font-size: 90%; margin-top: 2%;">CRIADOR DA RECEITA </p>*/

}

           /* When the user clicks on the button,
toggle between hiding and showing the dropdown content */
function myFunction() {
  document.getElementById("myDropdown").classList.toggle("show");
}

function filterFunction() {
  var input, filter, ul, li, a, i;
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  div = document.getElementById("myDropdown");
  a = div.getElementsByTagName("a");
  for (i = 0; i < a.length; i++) {
    txtValue = a[i].textContent || a[i].innerText;
    if (txtValue.toUpperCase().indexOf(filter) > -1) {
      a[i].style.display = "";
    } else {
      a[i].style.display = "none";
    }
  }
}

//FUNCAO DE ADICIONAR Á WISHLIST
async function addtolibrary(jogo){


console.log("Buy function working :D");


let utilizador_dinheiro = sessionStorage.getItem("utilizador_dinheiro");
var utilizador_id = sessionStorage.getItem("utilizador_id");
var jogo_id = jogo.jogo_id;
console.log("ID do Utilizador: " + utilizador_id);
console.log("ID do Jogo: " + jogo_id);
console.log("Preço do jogo: " + jogo.jogo_preco);
console.log("Tokens of user: " + utilizador_dinheiro);

let dinheiro_utilizador_int = parseInt(utilizador_dinheiro);
let jogo_price = parseInt(jogo.jogo_preco);
let dinheiro_restante = utilizador_dinheiro - jogo.jogo_preco;

try {

  //PRIMEIRAMENTE É REALIZADO UM MÉTODO PUT PARA ATUALIZAR O NOVO VALOR DE TOKENS

  if (dinheiro_utilizador_int >= jogo_price) {

    let jogo_comprado = await $.ajax({

     url: "/users/reduceprice/" + utilizador_id + "/" + dinheiro_restante,
     method: "put",
     dataType: "json",

    });

    //SEGUNDO, É REALIZADO UM MÉTODO POST PARA ADICIONAR O JOGO Á LIBRARY DO UTILIZADOR

    let data = {

      id_utilizador: utilizador_id,
// wishlist_jogo_id: jogo_id
      id_jogo: jogo_id,

    }

    let newLibraryGame = await $.ajax({

url: "/games/insertnewgamelibrary",
method: "post",
data: JSON.stringify(data),
contentType: "application/json",
dataType: "json"


});

console.log(newLibraryGame);

    
  }


 
  //console.log("[utilizador] utilizador = " + JSON.stringify(jogo_comprado));

  

} catch(err){
   console.log(err);
 }


}

//FUNCAO DE ADICIONAR Á WISHLIST
async function addtowishlist(jogo){


   console.log("Wishlist function working :D");
   console.log("ID do Jogo: " + jogo.jogo_id);
   var utilizador_id = sessionStorage.getItem("utilizador_id");
   var jogo_id = jogo.jogo_id;
   console.log("ID do Utilizador: " + utilizador_id);

   try {

 let data = {

   wishlist_user_id: utilizador_id,
   // wishlist_jogo_id: jogo_id
   wishlist_jogo_id: jogo_id,

 }

 let newWishlistGame = await $.ajax({

     url: "/games/insertnewgamewishlist",
     method: "post",
     data: JSON.stringify(data),
     contentType: "application/json",
     dataType: "json"

     
 });
 console.log(newWishlistGame);
} catch (err) {
 
   console.log(err);

}

console.log("Stored...");

}

           /* When the user clicks on the button,
toggle between hiding and showing the dropdown content */
function myFunction2() {
  document.getElementById("myDropdown2").classList.toggle("show");
}

function filterFunction2() {
  var input, filter, ul, li, a, i;
  input = document.getElementById("myInput2");
  filter = input.value.toUpperCase();
  div = document.getElementById("myDropdown2");
  a = div.getElementsByTagName("a");
  for (i = 0; i < a.length; i++) {
    txtValue = a[i].textContent || a[i].innerText;
    if (txtValue.toUpperCase().indexOf(filter) > -1) {
      a[i].style.display = "";
    } else {
      a[i].style.display = "none";
    }
  }
}

           /* When the user clicks on the button,
toggle between hiding and showing the dropdown content */
function myFunction3() {
  document.getElementById("myDropdown3").classList.toggle("show");
}

function filterFunction3() {
  var input, filter, ul, li, a, i;
  input = document.getElementById("myInput3");
  filter = input.value.toUpperCase();
  div = document.getElementById("myDropdown3");
  a = div.getElementsByTagName("a");
  for (i = 0; i < a.length; i++) {
    txtValue = a[i].textContent || a[i].innerText;
    if (txtValue.toUpperCase().indexOf(filter) > -1) {
      a[i].style.display = "";
    } else {
      a[i].style.display = "none";
    }
  }
}

          /* When the user clicks on the button,
toggle between hiding and showing the dropdown content */
function myFunction4() {
  document.getElementById("myDropdown4").classList.toggle("show");
}

function filterFunction4() {
  var input, filter, ul, li, a, i;
  input = document.getElementById("myInput4");
  filter = input.value.toUpperCase();
  div = document.getElementById("myDropdown4");
  a = div.getElementsByTagName("a");
  for (i = 0; i < a.length; i++) {
    txtValue = a[i].textContent || a[i].innerText;
    if (txtValue.toUpperCase().indexOf(filter) > -1) {
      a[i].style.display = "";
    } else {
      a[i].style.display = "none";
    }
  }
}

    

    

         </script>

        </body>

</html>
